services:
  configservice:
    build: ./configservice
    container_name: configservice
    ports:
      - "8081:8081"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8081/health"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 20s

  eurekaservice:
    build: ./eurekaservice
    container_name: eurekaservice
    ports:
      - "8761:8761"
    environment:
      - CONFIG_SERVICE_URL=http://configservice:8081
    depends_on:
      - configservice
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8761/actuator/health"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 20s

  gatewayservice:
    build: ./gatewayservice
    container_name: gatewayservice
    ports:
      - "8080:8080"
    environment:
      - EUREKA_URL=http://eurekaservice:8761
      - CONFIG_SERVICE_URL=http://configservice:8081
    depends_on:
      - eurekaservice
      - configservice
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 20s

  orderservice:
    build: ./orderservice
    container_name: orderservice
    ports:
      - "8002:8002"
    environment:
      - EUREKA_URL=http://eurekaservice:8761
      - CONFIG_SERVICE_URL=http://configservice:8081
      - GATEWAY_URL=http://gatewayservice:8080
    depends_on:
      - gatewayservice
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8002/orders/health"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 20s

  paymentservice:
    build: ./paymentservice
    container_name: paymentservice
    ports:
      - "8003:8003"
    environment:
      - EUREKA_URL=http://eurekaservice:8761
      - CONFIG_SERVICE_URL=http://configservice:8081
      - GATEWAY_URL=http://gatewayservice:8080
    depends_on:
      - gatewayservice
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8003/payments/health"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 20s

  productservice:
    build: ./productservice
    container_name: productservice
    ports:
      - "8001:8001"
    environment:
      - EUREKA_URL=http://eurekaservice:8761
      - CONFIG_SERVICE_URL=http://configservice:8081
      - GATEWAY_URL=http://gatewayservice:8080
    depends_on:
      - gatewayservice
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8001/products/health"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 20s

  userservice:
    build: ./userservice
    container_name: userservice
    ports:
      - "8004:8004"
    environment:
      - EUREKA_URL=http://eurekaservice:8761
      - CONFIG_SERVICE_URL=http://configservice:8081
      - GATEWAY_URL=http://gatewayservice:8080
    depends_on:
      - gatewayservice
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8004/users/health"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 20s